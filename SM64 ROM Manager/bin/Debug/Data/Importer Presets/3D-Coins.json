{
  "Name": "3D-Coins",
  "Description": "Import a 3D-Coin Model and automaticly apply the codes.",
  "Presets": [
    {
      "Name": "",
      "Description": "",
      "ScriptAfter": {
        "Name": "Apply 3D Coins Patches",
        "Script": "Imports Microsoft.VisualBasic\nImports System\nImports System.Linq\nImports System.IO\nImports SM64Lib\nImports System.Collections.Generic\nImports SM64Lib.Model.Fast3D\nImports SM64Lib.Model\nImports SM64Lib.Data\nImports System.Drawing\nImports System.Windows.Forms\nImports Devcomponents.DotNetBar\nImports SM64Lib.SegmentedBanking\n\nModule Script\n\n    Sub Main(params As IReadOnlyDictionary(Of String, Object))\n        Dim mdl As ObjectModel = params(\"ConvertedModel\")\n        Dim buf As Fast3DBuffer = mdl.Fast3DBuffer\n        Dim stream As New FileStream(params(\"romfile\"), FileMode.Open, FileAccess.ReadWrite)\n        Dim data As New BinaryStreamData(stream)\n        Dim offset As Integer = params(\"RomAddress\")\n        Dim geopointer As Integer = CType(params(\"GeoPointersArray\"), Integer()).FirstOrDefault\n        Dim bank03addr As Integer = SegmentedBanks.Bank0x3RomStart\n        Dim jumpvalue As Integer = &H3000000\n\n        'Navigate to Display List\n        data.Position = geopointer\n        data.Position = data.ReadInt32 - &H3000000 + bank03addr\n\n        'Search 03 commands\n        Dim cmd As Byte = 0\n        Dim found03 As Integer = 0\n        Dim ende As Boolean = False\n\n        Do\n            cmd = data.ReadByte\n            Select Case cmd\n                Case &HB8\n                    ende = True\n                Case &H3\n                    found03 += 1\n                    If found03 = 2 Then\n                        jumpvalue = data.Position + 7 - bank03addr + &H3000000\n                    End If\n            End Select\n            data.Position += 7\n        Loop Until ende\n\n        'Write jumpvalue to 03 commands for the yellow and blue coins\n        data.Position = &HAB9B64 'AB9B20 \n        data.Write(jumpvalue)\n        data.Position = &HAB9BB4 'AB9B70 \n        data.Write(jumpvalue)\n        \n        'Get coin colors\n        Dim colors as Colors3DCoin = GetColors\n\n        'Navigate to color in new model\n        data.Position = jumpvalue + bank03addr - &H3000000 - &HA\n        data.Position = data.ReadUInt16 + bank03addr\n\n        'Write red coin color to new model colors\n        WriteColor(data, colors.RedLight)\n        WriteColor(data, colors.RedDark)\n        \n        'Goto & Write colors for yellow coin\n        data.Position = &H30076A4 - &H3000000 + bank03addr\n        WriteColor(data, colors.YellowLight)\n        data.Position = &H30076AC - &H3000000 + bank03addr\n        WriteColor(data, colors.YellowDark)\n        \n        'Goto & Write colors for blue coin\n        data.Position = &H30076B4 - &H3000000 + bank03addr\n        WriteColor(data, colors.BlueLight)\n        data.Position = &H30076BC - &H3000000 + bank03addr\n        WriteColor(data, colors.BlueDark)\n        \n        stream.Close()\n    End Sub\n    \n    Function GetColors as Colors3DCoin\n        Dim frm as new GetColorsDialog\n        frm.Text = \"Edit Coins Color\"\n        \n        Dim colors as New Colors3DCoin\n        frm.LoadColors(colors)\n        \n        frm.ShowDialog\n        \n        frm.SaveColors(colors)\n        \n        return colors\n    End Function\n\n    Sub WriteColor(data as BinaryData, color as Color)\n        data.WriteByte(color.R)\n        data.WriteByte(color.G)\n        data.WriteByte(color.B)\n        data.WriteByte(&HFF) 'color.A\n        data.WriteByte(color.R)\n        data.WriteByte(color.G)\n        data.WriteByte(color.B)\n        data.WriteByte(&HFF) 'color.A\n    End Sub\n    \nEnd Module\n\nclass GetColorsDialog\n    inherits DevComponents.DotNetBar.OfficeForm\n    \n    public sub new\n        InitializeComponent\n        SetImageToPickerButtons\n    end sub\n    \n    private sub SetImageToPickerButtons\n        dim strData as string = \"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAqSURBVDhPY/j//z9FGEIAKXIwigEgmhQ8asCoASA8HA0gB8MNIB//ZwAAsSyVh9SDH54AAAAASUVORK5CYII=\"\n        dim arrData as byte() = convert.FromBase64String(strData)\n        dim ms as new MemoryStream(arrData)\n        dim img as Image\n        \n        img = Image.FromStream(ms)\n        ms.Close\n        \n        for each picker as ColorPickerButton in {ColorPickerButton1, ColorPickerButton2, ColorPickerButton3, ColorPickerButton4, ColorPickerButton5, ColorPickerButton6}\n            picker.Image = img\n        next\n    end sub\n    \n    Public sub LoadColors(colors as Colors3DCoin)\n        ColorPickerButton1.SelectedColor = colors.YellowLight\n        ColorPickerButton2.SelectedColor = colors.YellowDark\n        ColorPickerButton4.SelectedColor = colors.RedLight\n        ColorPickerButton3.SelectedColor = colors.RedDark\n        ColorPickerButton6.SelectedColor = colors.BlueLight\n        ColorPickerButton5.SelectedColor = colors.BlueDark\n    End sub\n    \n    public Sub SaveColors(colors as Colors3DCoin)\n        colors.YellowLight = ColorPickerButton1.SelectedColor\n        colors.YellowDark  = ColorPickerButton2.SelectedColor\n        colors.RedLight    = ColorPickerButton4.SelectedColor\n        colors.RedDark     = ColorPickerButton3.SelectedColor\n        colors.BlueLight   = ColorPickerButton6.SelectedColor\n        colors.BlueDark    = ColorPickerButton5.SelectedColor\n    End sub\n    \n    Protected Overrides Sub Dispose(ByVal disposing As Boolean)\n        Try\n            If disposing AndAlso components IsNot Nothing Then\n                components.Dispose()\n            End If\n        Finally\n            MyBase.Dispose(disposing)\n        End Try\n    End Sub\n    \n    Private components As System.ComponentModel.IContainer\n    \n    Private Sub InitializeComponent()\n        Me.LabelX1 = New DevComponents.DotNetBar.LabelX()\n        Me.ColorPickerButton1 = New DevComponents.DotNetBar.ColorPickerButton()\n        Me.LabelX2 = New DevComponents.DotNetBar.LabelX()\n        Me.LabelX3 = New DevComponents.DotNetBar.LabelX()\n        Me.ColorPickerButton2 = New DevComponents.DotNetBar.ColorPickerButton()\n        Me.ColorPickerButton3 = New DevComponents.DotNetBar.ColorPickerButton()\n        Me.ColorPickerButton4 = New DevComponents.DotNetBar.ColorPickerButton()\n        Me.LabelX6 = New DevComponents.DotNetBar.LabelX()\n        Me.ColorPickerButton5 = New DevComponents.DotNetBar.ColorPickerButton()\n        Me.ColorPickerButton6 = New DevComponents.DotNetBar.ColorPickerButton()\n        Me.LabelX4 = New DevComponents.DotNetBar.LabelX()\n        Me.ButtonX1 = New DevComponents.DotNetBar.ButtonX()\n        Me.SuspendLayout()\n        '\n        'LabelX1\n        '\n        '\n        '\n        '\n        Me.LabelX1.BackgroundStyle.CornerType = DevComponents.DotNetBar.eCornerType.Square\n        Me.LabelX1.Location = New System.Drawing.Point(3, 32)\n        Me.LabelX1.Name = \"LabelX1\"\n        Me.LabelX1.Size = New System.Drawing.Size(75, 23)\n        Me.LabelX1.TabIndex = 3\n        Me.LabelX1.Text = \"Yellow Coins:\"\n        '\n        'ColorPickerButton1\n        '\n        Me.ColorPickerButton1.AccessibleRole              = System.Windows.Forms.AccessibleRole.PushButton\n        Me.ColorPickerButton1.ColorTable                  = DevComponents.DotNetBar.eButtonColor.OrangeWithBackground\n        Me.ColorPickerButton1.Location                    = New System.Drawing.Point(84, 32)\n        Me.ColorPickerButton1.Name                        = \"ColorPickerButton1\"\n        Me.ColorPickerButton1.SelectedColorImageRectangle = New System.Drawing.Rectangle(2, 2, 12, 12)\n        Me.ColorPickerButton1.Size                        = New System.Drawing.Size(37, 23)\n        Me.ColorPickerButton1.Style                       = DevComponents.DotNetBar.eDotNetBarStyle.StyleManagerControlled\n        Me.ColorPickerButton1.TabIndex                    = 4\n        Me.ColorPickerButton1.FocusCuesEnabled            = False\n        Me.ColorPickerButton1.AutoExpandOnClick           = True\n        '\n        'LabelX2\n        '\n        '\n        '\n        '\n        Me.LabelX2.BackgroundStyle.CornerType = DevComponents.DotNetBar.eCornerType.Square\n        Me.LabelX2.Location = New System.Drawing.Point(84, 3)\n        Me.LabelX2.Name = \"LabelX2\"\n        Me.LabelX2.Size = New System.Drawing.Size(37, 23)\n        Me.LabelX2.TabIndex = 5\n        Me.LabelX2.Text = \"Light:\"\n        '\n        'LabelX3\n        '\n        '\n        '\n        '\n        Me.LabelX3.BackgroundStyle.CornerType = DevComponents.DotNetBar.eCornerType.Square\n        Me.LabelX3.Location = New System.Drawing.Point(127, 3)\n        Me.LabelX3.Name = \"LabelX3\"\n        Me.LabelX3.Size = New System.Drawing.Size(37, 23)\n        Me.LabelX3.TabIndex = 7\n        Me.LabelX3.Text = \"Dark:\"\n        '\n        'ColorPickerButton2\n        '\n        Me.ColorPickerButton2.AccessibleRole              = System.Windows.Forms.AccessibleRole.PushButton\n        Me.ColorPickerButton2.ColorTable                  = DevComponents.DotNetBar.eButtonColor.OrangeWithBackground\n        Me.ColorPickerButton2.Location                    = New System.Drawing.Point(127, 32)\n        Me.ColorPickerButton2.Name                        = \"ColorPickerButton2\"\n        Me.ColorPickerButton2.SelectedColorImageRectangle = New System.Drawing.Rectangle(2, 2, 12, 12)\n        Me.ColorPickerButton2.Size                        = New System.Drawing.Size(37, 23)\n        Me.ColorPickerButton2.Style                       = DevComponents.DotNetBar.eDotNetBarStyle.StyleManagerControlled\n        Me.ColorPickerButton2.TabIndex                    = 6\n        Me.ColorPickerButton2.FocusCuesEnabled            = False\n        Me.ColorPickerButton2.AutoExpandOnClick           = True\n        '\n        'ColorPickerButton3\n        '\n        Me.ColorPickerButton3.AccessibleRole              = System.Windows.Forms.AccessibleRole.PushButton\n        Me.ColorPickerButton3.ColorTable                  = DevComponents.DotNetBar.eButtonColor.OrangeWithBackground\n        Me.ColorPickerButton3.Location                    = New System.Drawing.Point(127, 61)\n        Me.ColorPickerButton3.Name                        = \"ColorPickerButton3\"\n        Me.ColorPickerButton3.SelectedColorImageRectangle = New System.Drawing.Rectangle(2, 2, 12, 12)\n        Me.ColorPickerButton3.Size                        = New System.Drawing.Size(37, 23)\n        Me.ColorPickerButton3.Style                       = DevComponents.DotNetBar.eDotNetBarStyle.StyleManagerControlled\n        Me.ColorPickerButton3.TabIndex                    = 11\n        Me.ColorPickerButton3.FocusCuesEnabled            = False\n        Me.ColorPickerButton3.AutoExpandOnClick           = True\n        '\n        'ColorPickerButton4\n        '\n        Me.ColorPickerButton4.AccessibleRole              = System.Windows.Forms.AccessibleRole.PushButton\n        Me.ColorPickerButton4.ColorTable                  = DevComponents.DotNetBar.eButtonColor.OrangeWithBackground\n        Me.ColorPickerButton4.Location                    = New System.Drawing.Point(84, 61)\n        Me.ColorPickerButton4.Name                        = \"ColorPickerButton4\"\n        Me.ColorPickerButton4.SelectedColorImageRectangle = New System.Drawing.Rectangle(2, 2, 12, 12)\n        Me.ColorPickerButton4.Size                        = New System.Drawing.Size(37, 23)\n        Me.ColorPickerButton4.Style                       = DevComponents.DotNetBar.eDotNetBarStyle.StyleManagerControlled\n        Me.ColorPickerButton4.TabIndex                    = 9\n        Me.ColorPickerButton4.FocusCuesEnabled            = False\n        Me.ColorPickerButton4.AutoExpandOnClick           = True\n        '\n        'LabelX6\n        '\n        '\n        '\n        '\n        Me.LabelX6.BackgroundStyle.CornerType = DevComponents.DotNetBar.eCornerType.Square\n        Me.LabelX6.Location = New System.Drawing.Point(3, 61)\n        Me.LabelX6.Name = \"LabelX6\"\n        Me.LabelX6.Size = New System.Drawing.Size(75, 23)\n        Me.LabelX6.TabIndex = 8\n        Me.LabelX6.Text = \"Red Coins:\"\n        '\n        'ColorPickerButton5\n        '\n        Me.ColorPickerButton5.AccessibleRole              = System.Windows.Forms.AccessibleRole.PushButton\n        Me.ColorPickerButton5.ColorTable                  = DevComponents.DotNetBar.eButtonColor.OrangeWithBackground\n        Me.ColorPickerButton5.Location                    = New System.Drawing.Point(127, 90)\n        Me.ColorPickerButton5.Name                        = \"ColorPickerButton5\"\n        Me.ColorPickerButton5.SelectedColorImageRectangle = New System.Drawing.Rectangle(2, 2, 12, 12)\n        Me.ColorPickerButton5.Size                        = New System.Drawing.Size(37, 23)\n        Me.ColorPickerButton5.Style                       = DevComponents.DotNetBar.eDotNetBarStyle.StyleManagerControlled\n        Me.ColorPickerButton5.TabIndex                    = 14\n        Me.ColorPickerButton5.FocusCuesEnabled            = False\n        Me.ColorPickerButton5.AutoExpandOnClick           = True\n        '\n        'ColorPickerButton6\n        '\n        Me.ColorPickerButton6.AccessibleRole              = System.Windows.Forms.AccessibleRole.PushButton\n        Me.ColorPickerButton6.ColorTable                  = DevComponents.DotNetBar.eButtonColor.OrangeWithBackground\n        Me.ColorPickerButton6.Location                    = New System.Drawing.Point(84, 90)\n        Me.ColorPickerButton6.Name                        = \"ColorPickerButton6\"\n        Me.ColorPickerButton6.SelectedColorImageRectangle = New System.Drawing.Rectangle(2, 2, 12, 12)\n        Me.ColorPickerButton6.Size                        = New System.Drawing.Size(37, 23)\n        Me.ColorPickerButton6.Style                       = DevComponents.DotNetBar.eDotNetBarStyle.StyleManagerControlled\n        Me.ColorPickerButton6.TabIndex                    = 13\n        Me.ColorPickerButton6.FocusCuesEnabled            = False\n        Me.ColorPickerButton6.AutoExpandOnClick           = True\n        '\n        'LabelX4\n        '\n        '\n        '\n        '\n        Me.LabelX4.BackgroundStyle.CornerType = DevComponents.DotNetBar.eCornerType.Square\n        Me.LabelX4.Location = New System.Drawing.Point(3, 90)\n        Me.LabelX4.Name = \"LabelX4\"\n        Me.LabelX4.Size = New System.Drawing.Size(75, 23)\n        Me.LabelX4.TabIndex = 12\n        Me.LabelX4.Text = \"Blue Coins:\"\n        '\n        'ButtonX1\n        '\n        Me.ButtonX1.AccessibleRole   = System.Windows.Forms.AccessibleRole.PushButton\n        Me.ButtonX1.ColorTable       = DevComponents.DotNetBar.eButtonColor.OrangeWithBackground\n        Me.ButtonX1.Location         = New System.Drawing.Point(48, 119)\n        Me.ButtonX1.Name             = \"ButtonX1\"\n        Me.ButtonX1.Size             = New System.Drawing.Size(75, 23)\n        Me.ButtonX1.Style            = DevComponents.DotNetBar.eDotNetBarStyle.StyleManagerControlled\n        Me.ButtonX1.TabIndex         = 15\n        Me.ButtonX1.Text             = \"Okay\"\n        Me.ButtonX1.DialogResult     = System.Windows.Forms.DialogResult.OK\n        Me.ButtonX1.FocusCuesEnabled = False\n        '\n        'benutzerste\n        '\n        Me.AutoScaleDimensions = New System.Drawing.SizeF(6.0!, 13.0!)\n        Me.AutoScaleMode = System.Windows.Forms.AutoScaleMode.Font\n        Me.Controls.Add(Me.ButtonX1)\n        Me.Controls.Add(Me.ColorPickerButton5)\n        Me.Controls.Add(Me.ColorPickerButton6)\n        Me.Controls.Add(Me.LabelX4)\n        Me.Controls.Add(Me.ColorPickerButton3)\n        Me.Controls.Add(Me.ColorPickerButton4)\n        Me.Controls.Add(Me.LabelX6)\n        Me.Controls.Add(Me.LabelX3)\n        Me.Controls.Add(Me.ColorPickerButton2)\n        Me.Controls.Add(Me.LabelX2)\n        Me.Controls.Add(Me.ColorPickerButton1)\n        Me.Controls.Add(Me.LabelX1)\n        Me.Name               = \"Set Coins Color\"\n        Me.ClientSize         = New System.Drawing.Size(170, 147)\n        Me.TopLeftCornerSize  = 0\n        Me.TopRightCornerSize = 0\n        Me.MaximizeBox        = False\n        Me.MinimizeBox        = False\n        Me.FormBorderStyle    = System.Windows.Forms.FormBorderStyle.FixedDialog\n        Me.DoubleBuffered     = True\n        Me.AcceptButton       = Me.ButtonX1\n        Me.EnableGlass        = False\n        Me.StartPosition      = FormStartPosition.CenterScreen\n        Me.ResumeLayout(False)\n\n    End Sub\n\n    Friend WithEvents LabelX1 As DevComponents.DotNetBar.LabelX\n    Friend WithEvents ColorPickerButton1 As DevComponents.DotNetBar.ColorPickerButton\n    Friend WithEvents LabelX2 As DevComponents.DotNetBar.LabelX\n    Friend WithEvents LabelX3 As DevComponents.DotNetBar.LabelX\n    Friend WithEvents ColorPickerButton2 As DevComponents.DotNetBar.ColorPickerButton\n    Friend WithEvents ColorPickerButton3 As DevComponents.DotNetBar.ColorPickerButton\n    Friend WithEvents ColorPickerButton4 As DevComponents.DotNetBar.ColorPickerButton\n    Friend WithEvents LabelX6 As DevComponents.DotNetBar.LabelX\n    Friend WithEvents ColorPickerButton5 As DevComponents.DotNetBar.ColorPickerButton\n    Friend WithEvents ColorPickerButton6 As DevComponents.DotNetBar.ColorPickerButton\n    Friend WithEvents LabelX4 As DevComponents.DotNetBar.LabelX\n    Friend WithEvents ButtonX1 As DevComponents.DotNetBar.ButtonX\n    \nEnd class\n\nClass Colors3DCoin\n    Public YellowLight as Color = Color.FromArgb(&Hffbfbf00)\n    Public YellowDark as Color = Color.FromArgb(&Hff7f7f00)\n    Public RedLight as Color = Color.FromArgb(&Hffff0000)\n    Public RedDark as Color = Color.FromArgb(&Hffa00000)\n    Public BlueLight as Color = Color.FromArgb(&Hff0000a0)\n    Public BlueDark as Color = Color.FromArgb(&Hff000060)\nEnd Class\n    ",
        "Type": "VisualBasic",
        "Description": "",
        "References": [],
        "ID": null
      },
      "ScriptBefore": {
        "Name": "Before",
        "Script": "Imports Microsoft.VisualBasic\r\nImports System\r\nImports System.Linq\r\nImports System.Windows.Forms\r\nImports System.IO\r\nImports SM64Lib\r\nImports System.Collections.Generic\r\nImports SM64Lib.Model\r\nimports System.Reflection\r\nImports DevComponents.DotNetBar\r\nImports System.ComponentModel\r\n\r\nModule Script\r\n\r\n    Sub Main(params as IReadOnlyDictionary(Of String, Object))\r\n        Dim myDataPath as string = Path.Combine(Path.GetDirectoryName(Assembly.GetEntryAssembly().Location), \"Data\")\r\n        \r\n        'Check if 3D-Coins are patched\r\n        Dim rommgr as RomManager = params(\"rommgr\")\r\n        If rommgr.RomConfig.NPCConfig.Enabled3DCoins Then\r\n            'Remove Collision from Model\r\n            Dim mdl As ObjectModel = params(\"ConvertedModel\")\r\n            mdl.Collision = Nothing\r\n        Else\r\n            '3D-Coins not patched, cancel operation\r\n            MessageBoxEx.Show(params(\"owner\"), \"The newest version of the 3D Coins are not patched. Please apply the 3D Coins Tweak before you continue.\", \"3D Coins not patched\", MessageBoxButtons.YesNo, MessageBoxIcon.Question)\r\n            Dim e as CancelEventArgs = params(\"cancelArgs\")\r\n            e.Cancel = True\r\n        End If\r\n        \r\n    End Sub\r\n\r\nEnd Module\r\n",
        "Type": "VisualBasic",
        "Description": "",
        "References": [],
        "ID": null
      },
      "RomAddress": 11238160,
      "RamAddress": 50353856,
      "MaxLength": 8164,
      "CollisionPointers": [],
      "GeometryPointers": [
        2199672
      ]
    }
  ],
  "Version": "1.0.0.0",
  "MinVersion": "1.10.0.0",
  "MaxVersion": "0.0.0.0",
  "FileName": "E:\\Userdata\\source\\repos\\SM64 ROM Manager\\SM64 ROM Manager\\bin\\Debug\\Data\\Importer Presets\\3D-Coins.json",
  "EmbeddedFiles": {
    "CompressedFiles": {}
  }
}